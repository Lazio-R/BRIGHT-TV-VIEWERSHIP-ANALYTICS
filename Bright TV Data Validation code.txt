SELECT * FROM BRIGHT_TV.TV_DATA.USER_PROFILES;
SELECT * FROM BRIGHT_TV.TV_DATA.VIEWERSHIP;

---------------Preview the tables---------------
SELECT * FROM VIEWERSHIP;
SELECT * FROM USER_PROFILES;

-------------Data Validation-------------
--total number of registered subscribers
SELECT
    COUNT(DISTINCT USERID) AS total_subscribers,
FROM USER_PROFILES;

--viewership information
SELECT min(recorddate2) as start_date,
        max(recorddate2) as start_date,
        min(duration_2) as minimum_duration,
        max(duration_2) as maximum_duration,
        count(distinct userid) as total_active_subscribers,
        count(userid) as total_subcriber_views,
        COUNT(DISTINCT CHANNEL2) AS number_of_channels,
        COUNT(CHANNEL2) AS views_per_channel,
      
FROM VIEWERSHIP;

---Aggregation---

SELECT USERID,
        CHANNEL2,
    COUNT(DISTINCT USERID) AS total_subscribers,
    COUNT(USERID) AS total_views,
    COUNT(DISTINCT CHANNEL2) AS number_of_channels,
    COUNT(CHANNEL2) AS views_per_channel,
FROM VIEWERSHIP
GROUP BY USERID, CHANNEL2;

----test joins

SELECT *
    FROM USER_PROFILES A
    INNER JOIN VIEWERSHIP B
    ON A.USERID = B.USERID;

SELECT *
    FROM USER_PROFILES A
    INNER JOIN VIEWERSHIP B
    ON A.USERID = B.USERID;
    

-------------Data Proceccing--------------
---Create case statements
  
-------------Date Function--------------
SELECT recorddate2,

    DAYNAME(TRY_TO_TIMESTAMP(b.recorddate2, 'MM/DD/YYYY HH24:MI')) AS day_name,
    MONTHNAME(TRY_TO_TIMESTAMP(b.recorddate2, 'MM/DD/YYYY HH24:MI')) AS month_name,
    TO_CHAR(TRY_TO_TIMESTAMP(b.recorddate2, 'MM/DD/YYYY HH24:MI'),'YYYY-MM') AS month_id,
    
    FROM USER_PROFILES A
    INNER JOIN VIEWERSHIP B
    ON A.USERID = B.USERID;
*********************************
SELECT 
  recorddate2,
  CONVERT_TIMEZONE('UTC', 'Africa/Johannesburg', TRY_TO_TIMESTAMP(recorddate2, 'MM/DD/YYYY HH24:MI')) AS sa_record_date,
  YEAR(TRY_TO_TIMESTAMP(recorddate2, 'MM/DD/YYYY HH24:MI')) AS year,
FROM viewership;